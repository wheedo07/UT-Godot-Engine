<?xml version="1.0" encoding="UTF-8" ?>
<class name="Bullet" inherits="CharacterBody2D" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/godotengine/godot/master/doc/class.xsd">
    <brief_description>
        [color=green](사용자 생성 가능)[/color]
        UT-Godot-Engine의 전투 시스템에서 사용되는 탄환(Bullet) 노드입니다.  
        Undertale 스타일의 탄환 움직임, 데미지, 효과 모드 등을 구현할 수 있습니다.
    </brief_description>
    <description>
        [b]Bullet[/b]는 Undertale 스타일 전투 시스템의 탄환을 구현하는 핵심 노드입니다.
        
        [b]주요 기능[/b]
        • 4가지 데미지 모드 (흰색, 초록색, 파란색, 주황색)
        • 속도 기반 또는 트윈 기반 이동 시스템
        • 플레이어 충돌 감지 및 처리
        • 자동 색상 변경 시스템
        • 페이드 아웃 및 삭제 효과
        • 카메라 흔들림 효과 연동
        
        [b]데미지 모드[/b]
        • [code]MODE_WHITE[/code]: 일반 탄환 (항상 데미지)
        • [code]MODE_GREEN[/code]: 회복 탄환 (HP 회복)
        • [code]MODE_BLUE[/code]: 파란색 탄환 (움직이면 데미지)
        • [code]MODE_ORANGE[/code]: 주황색 탄환 (멈추면 데미지)
        
        [b]이동 모드[/b]
        • [code]MOVEMENT_VELOCITY[/code]: velocity 속성을 사용한 물리 기반 이동
        • [code]MOVEMENT_TWEEN[/code]: 트윈을 사용한 애니메이션 기반 이동
        
        [b]가상 함수 시스템[/b]
        • C++과 GDScript 모두에서 오버라이드 가능한 가상 함수 제공
        • 플레이어와의 다양한 상호작용 구현 가능
        
        [b]예시 (GDScript)[/b]
        [codeblock]
        extends Bullet
        
        func ready():
            # 탄환 초기화
            damage = 10
            set_mode(MODE_BLUE)
            velocity = Vector2(0, 200)  # 아래로 이동
        
        func on_hit_player():
            # 플레이어 충돌 시 특별한 효과
            emit_signal("shake_camera", 0.3)
            kill();
        [/codeblock]
        
        [b]주의사항[/b]
        • [method _physics_process] 함수는 오버라이드할 수 없습니다.
        • [member delete_upon_hit]가 true일 시 [method on_hit_player] 함수는 호출되지 않습니다.
        • [member sprite_path]는 반드시 설정해야 색상 변경이 작동합니다.
    </description>
    <tutorials></tutorials>
    
    <methods>
        <method name="ready" qualifiers="virtual">
            <return type="void"/>
            <description>
                탄환 초기화 함수입니다. C++과 GDScript에서 오버라이드 가능합니다.
                탄환의 속성, 이동 방향, 특수 효과 등을 설정할 때 사용합니다.
                [member sprite_path]로 지정된 스프라이트는 이미 초기화된 상태입니다.
            </description>
        </method>
        
        <method name="on_hit_player" qualifiers="virtual">
            <return type="void"/>
            <description>
                플레이어 영혼과 충돌했을 때 호출되는 가상 함수입니다.
                특별한 충돌 효과나 상호작용을 구현할 때 사용합니다.
                [b]주의:[/b] [member delete_upon_hit]가 true면 이 함수는 호출되지 않습니다.
            </description>
        </method>
        
        <method name="on_hit_yellow" qualifiers="virtual">
            <return type="void"/>
            <description>
                노란색 영혼의 탄환에 충돌했을 때 호출되는 가상 함수입니다.
                노란색 영혼 모드에서의 특별한 상호작용을 구현할 때 사용합니다.
            </description>
        </method>
        
        <method name="on_hit_player_shield" qualifiers="virtual">
            <return type="void"/>
            <description>
                초록색 영혼의 방패에 막혔을 때 호출되는 가상 함수입니다.
                방패와의 상호작용이나 특별한 효과를 구현할 때 사용합니다.
            </description>
        </method>
        
        <method name="set_mode">
            <return type="Bullet"/>
            <param index="0" name="mode" type="int" enum="Bullet.DamageMode" default="2"/>
            <description>
                탄환의 데미지 모드를 설정합니다.
                색상도 자동으로 해당 모드에 맞게 변경됩니다.
                자기 자신을 반환하므로 메서드 체이닝이 가능합니다.
            </description>
        </method>
        
        <method name="kill">
            <return type="void"/>
            <description>
                탄환을 즉시 삭제합니다.
                실행 중인 트윈이 있다면 중단하고 [method queue_free]를 호출합니다.
                애니메이션 없이 바로 제거하고 싶을 때 사용합니다.
            </description>
        </method>
        
        <method name="fade">
            <return type="void"/>
            <description>
                탄환을 페이드 아웃 효과와 함께 삭제합니다.
                0.5초에 걸쳐 투명도를 0으로 만든 후 삭제됩니다.
                [signal bullet_fade] 시그널을 발생시킵니다.
            </description>
        </method>

        <method name="on_exit_screen">
            <return type="void"/>
            <description>
                VisibleOnScreenNotifier2D 노드에 screen_exited 시그널과 연결용 함수입니다
            </description>
        </method>
    </methods>
    
    <members>
        <member name="damage" type="int" setter="set_damage" getter="get_damage" default="5">
            탄환이 플레이어에게 가하는 데미지 값입니다.
            0-100 범위의 값을 가질 수 있습니다.
        </member>
        
        <member name="iframe_grant" type="int" setter="set_iframe_grant" getter="get_iframe_grant" default="50">
            플레이어가 피격 시 부여받는 무적 프레임 수입니다.
            값이 클수록 더 오래 무적 상태가 유지됩니다.
        </member>
        
        <member name="kr_amount" type="int" setter="set_kr_amount" getter="get_kr_amount" default="5">
            KR(Karmic Retribution) 데미지량입니다.
            시간이 지나면서 서서히 HP를 감소시키는 효과에 사용됩니다.
        </member>
        
        <member name="delete_upon_hit" type="bool" setter="set_delete_upon_hit" getter="get_delete_upon_hit" default="false">
            플레이어와 충돌 시 탄환을 자동으로 삭제할지 여부입니다.
            true면 [method on_hit_player] 함수가 호출되지 않고 즉시 삭제됩니다.
        </member>
        
        <member name="sprite_path" type="NodePath" setter="set_sprite_path" getter="get_sprite_path" default="NodePath(&quot;&quot;)">
            탄환의 스프라이트 노드 경로입니다.
            색상 변경 효과를 위해 반드시 설정해야 합니다.
            [CanvasItem]을 상속받는 노드여야 합니다.
        </member>
        
        <member name="colors" type="Array" setter="set_colors" getter="get_colors">
            탄환 모드에 따른 색상 배열입니다.
            인덱스 순서: [0]=흰색, [1]=초록색, [2]=파란색, [3]=주황색
            기본값: [Color.WHITE, Color.GREEN, Color(0, 0.85, 1), Color(1, 0.65, 0)]
        </member>
        
        <member name="velocity_tween" type="Tween" setter="set_velocity_tween" getter="get_velocity_tween">
            트윈 이동에 사용되는 [Tween] 객체입니다.
        </member>
    </members>
    
    <signals>
        <signal name="bullet_fade">
            <description>
                [method fade] 호출 시 자동으로 발생합니다.
            </description>
        </signal>
        
        <signal name="shake_camera">
            <param index="0" name="shake_amt" type="float"/>
            <description>
                카메라 흔들림을 요청하는 시그널입니다.
                [param shake_amt]는 흔들림의 강도를 나타냅니다.
                [AttackBase]에서 자동으로 카메라와 연결됩니다.
            </description>
        </signal>
    </signals>
    
    <constants>
        <constant name="MOVEMENT_VELOCITY" value="0" enum="MovementMode">
            velocity 속성을 사용한 물리 기반 이동 모드입니다.
            [method move_and_slide]를 사용하여 연속적인 이동을 처리합니다.
            일정한 속도로 움직이는 탄환에 적합합니다.
        </constant>
        
        <constant name="MOVEMENT_TWEEN" value="1" enum="MovementMode">
            트윈을 사용한 애니메이션 기반 이동 모드입니다.
            복잡한 경로나 가속/감속 효과가 필요한 탄환에 적합합니다.
            [member velocity_tween]을 통해 제어됩니다.
        </constant>
        
        <constant name="MODE_WHITE" value="0" enum="DamageMode">
            일반 탄환 모드입니다.
            플레이어와 충돌 시 항상 데미지를 가합니다.
            색상은 흰색으로 표시됩니다.
        </constant>
        
        <constant name="MODE_GREEN" value="1" enum="DamageMode">
            회복 탄환 모드입니다.
            플레이어와 충돌 시 HP를 회복시킵니다.
            색상은 초록색으로 표시됩니다.
        </constant>
        
        <constant name="MODE_BLUE" value="2" enum="DamageMode">
            파란색 탄환 모드입니다.
            플레이어가 움직이고 있을 때만 데미지를 가합니다.
            정지 상태에서는 무해합니다.
        </constant>
        
        <constant name="MODE_ORANGE" value="3" enum="DamageMode">
            주황색 탄환 모드입니다.
            플레이어가 정지해 있을 때만 데미지를 가합니다.
            움직이는 상태에서는 무해합니다.
        </constant>
    </constants>
</class>